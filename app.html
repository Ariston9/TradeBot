<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>TradeBot Panel</title>
  <script src="https://s3.tradingview.com/tv.js"></script>
  <style>
    body { margin: 0; background: #0e0e0e; color: white; font-family: Arial; }
    #tv_chart_container { height: 80vh; }
    #signals { padding: 10px; background: #111; border-top: 1px solid #333; }
    .signal { margin: 5px 0; }
    .buy { color: #4CAF50; }
    .sell { color: #F44336; }
  </style>
</head>
<body>

  <div id="tv_chart_container"></div>
  <div id="signals"></div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const symbol = urlParams.get("symbol") || "EURUSD";
    const api = urlParams.get("api");

    // TradingView –≥—Ä–∞—Ñ–∏–∫
    new TradingView.widget({
      autosize: true,
      symbol: symbol,
      interval: "1",
      timezone: "Etc/UTC",
      theme: "dark",
      style: "1",
      container_id: "tv_chart_container",
      studies: ["MACD@tv-basicstudies", "RSI@tv-basicstudies"]
    });

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∏–≥–Ω–∞–ª—ã —Å –±–æ—Ç–∞
    async function loadSignals() {
      const res = await fetch(api + "/signals?symbol=" + symbol);
      const data = await res.json();
      const container = document.getElementById("signals");
      container.innerHTML = "<h3>üìä –°–∏–≥–Ω–∞–ª—ã:</h3>";
      data.forEach(sig => {
        const el = document.createElement("div");
        el.className = "signal " + (sig.direction === "BUY" ? "buy" : "sell");
        el.textContent = `${sig.time} ‚Üí ${sig.direction} (${sig.reason})`;
        container.appendChild(el);
      });
    }

    loadSignals();
    setInterval(loadSignals, 15000); // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫
  </script>

</body>
</html>
